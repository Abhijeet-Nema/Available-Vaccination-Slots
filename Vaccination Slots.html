<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <title>API's Usage</title>
</head>

<style type="text/css" media="all">
    #close {
     position: absolute;
     top: 0;
     right: 0;
     padding: 0px 9px;
     color: white;
     z-index: 10;
     font-size: 25px;
     display : none;
     transition: all 0.2s ease;
     opacity: 0.78;
     
 }   
 
 
    #close:hover, #close:active {
         background: red;
         display: block;
     }
</style>

<body>



<script src="https://apps.elfsight.com/p/platform.js"></script>



<div id="Stats" class="elfsight-app-2269051a-05f6-428d-a7e7-42b1173c8bb3"></div>

<div id="close">
    &#x2715;
</div>



    <div class="container my-3">

        <h2 class="my-2" style="font-family: 'EB Garamond', serif;"> Search Vaccination's Slots by Pincode - </h2>
        <input type="text" class="form-control my-2" name="PinCodeBox" id="PinCodeBox"
            placeholder="Enter Your City's Pincode">
        <input type="text" class="form-control my-1" name="DateCodeBox" id="DateCodeBox"
            placeholder="Enter a date like 27-05-2021">

        <button id="SetDateBtn" class="btn btn-primary my-1">Set Another Date</button>

        <button id="FetchBtn" class="btn btn-success my-1">Fetch Information</button>

        

        <div class="input-group my-2" id="FilterResults">
            <select class="form-select" id="AgeFilteration" aria-label="Example select with button addon">
                <option selected>Filter Results By Age -</option>
                <option value="18">18</option>
                <option value="45">45</option>
                <!-- <option value="3">Three</option> -->
            </select>
            <button id="FilterBtn" class="btn btn-outline-dark" type="button">Filter</button>
        </div>

        <hr>

        <div class="my-3" id="informationConatiner"> </div>

        
    </div>
    


</body>
<!--   <script src="index.js"></script>-->


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

<script type="text/javascript" charset="utf-8">

    console.log("Welcome");

    //Grabbing The Elements
    let PinCodeBox = document.getElementById("PinCodeBox");
    let DateCodeBox = document.getElementById("DateCodeBox");
    DateCodeBox.style.display = 'none';
    let SetDateBtn = document.getElementById("SetDateBtn");
    let FilterResults = document.getElementById("FilterResults");
    FilterResults.style.display = "none";
    let FilterBtn = document.getElementById("FilterBtn");

    let pincode;
    let url;
    // let pincode = "462001";
    let date;
    let id = 359;
    let Data;
    let FetchBtn = document.getElementById("FetchBtn");
    let informationConatiner = document.getElementById("informationConatiner");
    informationConatiner.innerHTML = ` <strong> Tip : </strong>Try Setting With Proper Pincode. You also can set another date if You want to. By default, it has been set to Today's date.`;
    /*informationConatiner.style.fontSize = "0.9rem";
    informationConatiner.style.color = "grey";*/



    // let data = {
    //     "mobile": "7389056709"
    // }

    // let Details = {
    //     method : "POST",
    //     body : JSON.stringify(data),
    //     headers : {
    //         "Content-Type":"application/json"
    //     }

    // }
    FetchBtn.addEventListener("click", FetchFunction);



    function FetchFunction() {


        if (DateCodeBox.style.display == "none") {

            let TodayDate = new Date();
            let TDate = TodayDate.getDate();
            let TMonth = TodayDate.getMonth() + 1;
            let TYear = TodayDate.getFullYear();


            if (String(TDate).length < 2) {
                TDate = `0${String(TDate)}`;
            }

            else {
                TDate = String(TDate);
            }


            if (String(TMonth).length < 2) {
                TMonth = `0${String(TMonth)}`;
            }

            else {
                TMonth = String(TMonth);
            }

            date = `${TDate}-${TMonth}-${TYear}`;
        }

        else {
            DateCodeBox.style.display = "none";
            SetDateBtn.innerHTML = "Set Another Date";
            date = DateCodeBox.value;

        }

        //console.log(date);



        pincode = PinCodeBox.value;
        //date = DateCodeBox.value;
        url = `https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByPin?pincode=${pincode}&date=${date}`;

        let RegExpPin = /^([0-9]){6}$/;
        let RegExpDate = /^([0-3][0-9])\-([0,1][0-9])\-([0-9]{4})$/;

        if (!RegExpPin.test(pincode)) {
            informationConatiner.innerHTML = `<strong> <small> Warning : The Pincode You entered is not a valid Pincode..correct it and try again </small> </strong>`;
            informationConatiner.classList.add("alert");
            informationConatiner.classList.add("alert-danger");
            informationConatiner.setAttribute("role", "alert");
            PinCodeBox.value = "";
            FilterResults.style.display = "none";

            return;

        }

        if (!RegExpDate.test(date)) {

            informationConatiner.innerHTML = `
 <strong> <small> Warning : The Date You entered is not valid...It should also be in DD-MM-YYYY format, correct it and try again </small> </strong>`;
            informationConatiner.classList.add("alert");
            informationConatiner.classList.add("alert-danger");
            informationConatiner.setAttribute("role", "alert");
            DateCodeBox.value = "";
            FilterResults.style.display = "none";

            return;

        }

        informationConatiner.className = "my-3";

        //console.log(informationConatiner.classList);


        // console.log(pincode);

        // let url = `https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByDistrict?district_id=${id}&date=${date}`;
        // let url = `https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByPin?pincode=${pincode}&date=${date}`;

        // url = "https://cdndemo-api.co-vin.in/api/v2/appointment/sessions/findByDistrict?district_id=512&date=26%2F05%2F2021";

        // https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByPin?pincode=110001&date=31-03-2021

        // let Res = await fetch(url);

        // let Data = await Res.json();

        fetch(url).then((response) => {
            informationConatiner.innerHTML = `<em> Loading... </em>`;
            return response.json();
        }).then((Result) => {
            // console.log(Result);

            DisplayResults(Result);

        });

        // return Data;


    }


    window.addEventListener("keydown", (e) => {
        if (e.key == "Enter") {
            // alert(e.key);
            FetchFunction();

        }

    })




    // FetchFunction().then((result) => {
    //     console.log("Success...");

    // }).catch((err) => {
    //     console.log(err);
    // });


    SetDateBtn.addEventListener("click", () => {

        if (DateCodeBox.style.display == "none") {
            DateCodeBox.style.display = "block";
            SetDateBtn.innerHTML = "Continue with Today's Date";

        }

        else {
            DateCodeBox.style.display = "none";
            SetDateBtn.innerHTML = "Set Another Date";

        }

    })


    function DisplayResults(Result) {

        let DataArr = Result.sessions;

        if (DataArr.length == 0) {
            FilterResults.style.display = "none";
            informationConatiner.innerHTML = `<em> No Sessions Available... </em>`;
        }

        else {

        FilterResults.style.display = "flex";

            // console.log(DataArr);
            let TempStr = "";

            DataArr.forEach((element, index) => {
                // console.log(element, index)

                TempStr += ` 
        
            
    <table class="table caption-top table-dark table-striped SearchResults">
    <caption> <h3> ${element["address"]}  </h3></caption>
            
        <tr class="table-dark">
        <th class="table-dark"> Center Location  </th>
        <td class="table-dark">${element["name"]} </td>
        </tr>

        <tr class="table-dark">
        <th class="table-dark"> Center id  </th>
        <td class="table-dark"> ${element["center_id"]} </td> 
        </tr>
        
        <tr class="table-dark"> 

        <th class="table-dark"> Minimun Age Criteria </th>  

        <td class="table-dark Age">${element["min_age_limit"]}</td> 
        </tr>

        <tr class="table-dark"> 
        <th class="table-dark"> Date  </th>  
        <td class="table-dark"> ${element["date"]} </td> 
        </tr>
        
        <tr class="table-dark"> 
        <th class="table-dark"> District  </th>  
        <td class="table-dark"> ${element["district_name"]}   </td>
        </tr>
        
        <tr class="table-dark"> 
        <th class="table-dark"> State </th>  
        <td class="table-dark">${element["state_name"]} </td>  
        </tr>
        
        <tr class="table-dark"> 
        <th class="table-dark">  Available Dose 1  </th>  
        <td class="table-dark">${element["available_capacity_dose1"]}   </td> 
        </tr>
        
        <tr class="table-dark"> 
        <th class="table-dark">  Available Dose 2 </th>  
        <td class="table-dark">  ${element["available_capacity_dose2"]}   </td> 
        </tr>
        
        <tr class="table-dark">

        <th class="table-dark"> Vaccine  </th>

        <td class="table-dark">${element["vaccine"]} </td>
        </tr>


        
        </table>
        `;

            });

            informationConatiner.innerHTML = TempStr;
            PinCodeBox.value = "";
            DateCodeBox.value = "";
            AgeFilteration.value = "Filter Results By Age -"

        }
        // console.log(Result);

    }

    FilterBtn.addEventListener("click", ()=>{

        // console.log(DataArr);

        let AgeFilteration = document.getElementById("AgeFilteration");

        let SearchResults = document.getElementsByClassName("SearchResults");

        Array.from(SearchResults).forEach((ResultData)=>{
            //  console.log(ResultData);

            if (AgeFilteration.value == "Filter Results By Age -") {
                AgeFilteration.value = "";
            }

            let ToFlilter = ResultData.children[1].children[2].children[1].innerText.trim();

            // console.log(ToFlilter);

            // console.log(AgeFilteration.value);

            if(!ToFlilter.includes(AgeFilteration.value)) {
                ResultData.style.display = "none";
            }

            else {
                ResultData.style.display = "table";

            }

            // AgeFilteration.value = "Filter Results By Age -";

        



            

        })







    })



let close = document.getElementById("close");
let Stats = document.getElementById("Stats")
    
    close.addEventListener("click",()=>{
        
    Stats.style.display = "none";
    close.style.display = "none";
    
        
    })

    Stats.addEventListener('mouseover',()=>{
        
         close.style.display = "block";
    })
    
    document.getElementsByClassName("container")[0].addEventListener("mouseover",()=>{
        
        close.style.display = "none";
        
        
    })



</script>

</html>